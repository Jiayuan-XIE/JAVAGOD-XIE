# 计算机网路基础知识

## 1.体系结构

![五层体系结构](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCE48b66bd3105e41fe925c4d2a236cf8d1/772)



### 物理层

**物理层(physical layer)的作用是尽可能屏蔽掉具体传输介质和物理设备的差异，实现相邻计算机节点之间比特流的透明传送。**



### 数据链路层

**将上层的数据，无比特差错的传输到相邻节点目标机网络层**

三个基本问题：

- 封装成帧
- 透明传输
- 差错检测



### 网络层

**实现在复杂的网络上，选择合适的网间路由和交换结点，让主机A尽可能的找到主机B**



### 运输层

**为进程之间提供端到端的逻辑通信**



### 会话层

建立和维持会话，并能使会话获得同步。有断点记录功能（记录点），对于传输大文件极为重要。



### 表示层

表示层负责数据格式的转换，将应用处理的信息转换为适合网络传输的格式，

表示层的主要作用之一是为异种机通信提供一种公共语言，以便能进行交互操作。这种类型的服务之所以需要，是因为不同的计算机体系结构使用的数据表示法不同。



### 应用层

精确定义网络应用进程之间的通信规则，通过应用进程之间的交互来完成特定的互联网应用



### 常见设备

![img](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCE692b3a0c5c9349e399ff5db30a298fc7/1995)



## 2.TCP连接建立—三次握手

![这里写图片描述](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCEd8263d5fa53440ef995d1f993e51acce/773)

过程：

> 1. 客户端A说：我要和你建立连接啦
> 2. 服务端B说：可以，来连接吧
> 3. 客户端A说：好，我们开始吧



#### 为啥需要第三次握手

要不建立连接**就太容易了**

万一服务器B接收到一个**“失效的连接报文段”**，服务器B就会**傻傻的等待**客户端A发送数据，从而造成资源浪费。

所以最后一次握手，也说告诉服务器B，我是认真的（有效的），不是闹着玩的。



## 3.TCP连接释放—四次挥手



![这里写图片描述](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCE47ba8ab537b34dd5949c39fae8aa35e2/774)

过程：

> 1. 客户端A说：我没啥发的了，可以结束了
> 2. 服务端B说：我知道了，等我把剩下的发完，就结束
> 3. 服务端B说：我数据发完了，可以结束了
> 4. 客户端A说：OK，那就结束吧



#### 为啥最后还等2个MSL（Maximum Segment Lifitime)

1. 防止出现服务器B无法正常关闭的情况，最后一个ACK报文段丢失，服务器B就认为它发出的释放报文段丢了，就会重新发，如果客户端没有等待2MSL，而是直接关闭，那服务器就会一直傻傻的发送释放报文段，从而无法正常关闭，浪费资源。
2. 缓一缓，防止“已经失效的请求连接报文段出现在本次连接中。



#### TCP三次握手特定导致的SYN洪泛攻击

![在这里插入图片描述](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCE1e65b2937cfc4ce586f4585b093de13a/1985)



## 4.在浏览器中输入url地址 ->> 显示主页的过程(面试常客)

![img](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCEdeae2f140c4647ae80a3641019051009/775)



1. 域名解析
2. 建立TCP连接（SSL四次握手+TCP三次握手）
3. 向服务器发送HTTPS请求
4. 服务器处理请求
5. 服务器返回一个HTML相应
6. 浏览器接收到响应，开始渲染页面。
7. 断开TCP连接（四次挥手）



#### 细节

#### 域名解析

浏览器搜索自己的DNS缓存（维护一张域名与IP地址的对应表）

若没有，则搜索操作系统中的DNS缓存（维护一张域名与IP地址的对应表）

若没有，则搜索操作系统的hosts文件（Windows环境下，维护一张域名与IP地址的对应表，位置一般在 C:\Windows\System32\drivers\etc\hosts）

若没有，则操作系统将域名发送至 本地域名服务器- -（递归查询方式），本地域名服务器 查询自己的DNS缓存，查找成功则返回结果，否则，（以下是迭代查询方式）

(1) 本地域名服务器 向**根域名服务器**（其虽然没有每个域名的具体信息，但存储了负责每个域，如com、net、org等的解析的顶级域名服务器的地址）发起请求，此处，根域名服务器返回com域的顶级域名服务器的地址

(2) 本地域名服务器 向com域的**顶级域名服务器**发起请求，返回baidu.com权限域名服务器（权限域名服务器，用来保存该区中的所有主机域名到IP地址的映射）地址

(3) 本地域名服务器 向baidu.com**权限域名服务器**发起请求，得到www.baidu.com的IP地址



**本地域名服务器** 将得到的IP地址返回给操作系统，同时自己也将IP地址缓存起来

操作系统将 IP 地址返回给浏览器，同时自己也将IP地址缓存起来

至此，浏览器已经得到了域名对应的IP地址

![image-20210731134805129](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCEb2c7427a8786405ba7dfac9b26f3d6c1/1974)

## 5.各个层的协议

![image-20210726125735284](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCE2756c605c0bd4e38bf234f69d9f2d4fb/779)



## 6.TCP协议如何保证可靠传输

考虑4个方面：

- 有序的
- 无差错的
- 无遗漏的
- 稳定的



1. **切块和编号**：数据被分割成 TCP 认为最适合发送的数据块，并编号保证**有序性。**
2. **校验和**：保证数据**无差错**， TCP 将保持它首部和数据的检验和，一旦出错就丢弃
3. **停止等待确认，超时就自动重传**：发送方每一次发送数据之后都需要接收方进行**确认ARQ协议**，自动重传请求，在不可靠服务的基础上实现可靠的信息传输。
5. **流量控制**：**滑动窗口机制**，**保证接收方来得及接收**。
6. **拥塞控制**：网络堵塞

![TCP、UDP协议的区别](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCE97f73f10531b49928c4f86bcfd43cfc7/2009)

场景：

TCP:文件传输、发送和接收邮件、远程登录等场景。

UDP:QQ 语音、 QQ 视频 、直播等等。



## 7.状态码

![状态码](http://note.youdao.com/yws/public/resource/7d81e6a39024a96dd86efacf29f4ca80/xmlnote/WEBRESOURCEe4e9b128220e4045abc692d45ae47e28/1968)

| 状态码  | 状态码英文名称            | 中文描述                                                     |
| :------ | :------------------------ | :----------------------------------------------------------- |
| **100** | **Continue**              | **继续。客户端应继续其请求**                                 |
| 101     | Switching Protocols       | 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议 |
|         |                           |                                                              |
| **200** | **OK**                    | **请求成功。一般用于GET与POST请求**                          |
|         |                           |                                                              |
| **301** | **Moved Permanently**     | **永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替** |
| **302** | **Found**                 | **临时移动（临时重定向）。与301类似。但资源只是临时被移动。客户端应继续使用原有URI** |
| **307** | **Temporary Redirect**    | **临时重定向。与302类似。使用GET请求重定向**                 |
|         |                           |                                                              |
| **400** | **Bad Request**           | **客户端请求的语法错误，服务器无法理解**                     |
| **403** | **Forbidden**             | **服务器理解请求客户端的请求，但是拒绝执行此请求**（爬虫常见） |
| **404** | **Not Found**             | **服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置"您所请求的资源无法找到"的个性页面** |
|         |                           |                                                              |
| **500** | **Internal Server Error** | **服务器内部错误，无法完成请求**                             |



## URI与URL

URI是统一资源标识符，是一个抽象概念，只要能唯一标识这个资源就行。（身份证号）

URL是统一资源定位符，是一个具体的地址，根据这个地址，不仅能够唯一标识资源，还能找到它（身份证号+地址）

URL是URI的子集，是它的一种具体实现方式。





## 8. Cookie、Session、Token

### 8.1 Cookie、Session

它俩是在http通信中，用来保存用户状态的一种机制，Cookie在用户端，Session在服务端，它们相互协作。



### 8.2 登录过程

1）客户端发起请求



2）服务端进行用户身份验证

若验证成功，就把用户的登陆状态与SessionID绑定在一起，记录在服务端（占用内存空间）。

并将SessionID放在响应报文里，返回给用户。



3）客户端接收响应，并将SessionID作为Cookie保存在本地

在以后的请求报文中，通过Cookie将SessionID发送到服务端，服务端通过SessionID验证用户的身份以及登陆状态。



### 8.3 Token

Session有一些缺点：

- **占用服务端资源**。

- **安全性低**：一旦被窃取，可能会受到**跨站伪造请求**的攻击（截取Cookie，并伪造一个请求）。

  XSS:攻击者通过在用户访问的网页里嵌入恶意代码，从而产生恶意行为。

- **拓展性差**：不适用与多服务器的负载均衡方案。



**使用Token令牌**：服务器生成Token，并通过验证Token，来验证用户的身份以及获取用户的状态。

是一种**时间换空间**的思想：服务器不再保存用户状态信息，而是验证token。



**安全问题解决方案：**

- 加入用户访问IP
- 设置过期时间



