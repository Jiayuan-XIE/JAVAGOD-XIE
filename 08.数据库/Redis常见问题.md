## 1. 分布式缓存技术选型

常见的有Memcached和Redis。

Redis更加强大



## 2. Memcached和Redis的区别

共同点：

- 都是内存数据库
- 性能都很高，一般都用来实现缓存
- 都有过期策略



区别：

- Redis支持的**数据类型丰富**：Redis支持5种，而Memcached只支持一种k-v
- Redis支持**数据的持久化**，保存到磁盘中，重启后还能恢复使用，而Memcached不支持
- Redis有**灾难恢复机制**
- Redis**内存空间优化机制**，内存满了，可以把无用的数据放磁盘上，而Memcached直接报异常
- Redis **使用单线程的多路 IO 复用模型。Memcached 是多线程，非阻塞 IO 复用的网络模型**。（Redis 6.0 引入了多线程 IO ）
- **Redis 支持发布订阅模型、Lua 脚本、事务等功能，而 Memcached 不支持。并且，Redis 支持更多的编程语言。**
- **Redis 同时使用了惰性删除与定期删除。Memcached 过期数据的删除策略只用了惰性删除**



## 3. 为什么要用Redis / 为什么要用缓存

- 提高服务器响应速度（**性能**），从而提高用户体验
- 提高服务器的**并发能力**，以服务更多的用户

一般像 MySQL 这类的数据库的 QPS 大概都在 1w 左右（4 核 8g） ，但是使用 Redis 缓存之后很容易达到 10w+，甚至最高能达到 30w+（就单机 redis 的情况，redis 集群的话会更高）。



## 4. 除了缓存，redis还能用来做什么？

- **分布式锁**：一般基于 Redisson 来实现分布式锁
- **限流**：Redis + Lua 脚本
- **消息队列**：Redis 自带的 list 数据结构可以作为一个简单的队列使用。Redis5.0 中增加的 Stream 类型的数据结构更加适合用来做消息队列。
- **复杂业务场景**： 统计活跃用户、统计用户签到情况、通过 sorted set 维护排行榜。





## 5. 缓存穿透、缓存击穿、缓存雪崩

### 5.1 缓存穿透（id暴力攻击）

可能是暴力行为，

发起的请求，缓存中没有，数据库也没有，都穿透了

缓存穿透是指缓存和数据库中都没有的数据，而用户不断发起请求，如发起为id为“-1”的数据或id为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大。

攻击性行为，id暴力攻击

#### 解决方案

1. **接口校验，进行拦截**

2. **缓存无效KEY返回null数据**（敷衍一下）

   从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击



### 5.2 缓存击穿(一个过期的key)

非攻击行为，发起的请求，缓存中没有，但数据库有

缓存击穿是指**缓存中没有但数据库中有的数据**（一般是**缓存时间到期**），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起**数据库压力瞬间增大，造成过大压力**



#### 解决方案

1. 设置热点数据永远不过期。
2. 加互斥锁



### 5.3 缓存雪崩

缓存雪崩是指**缓存中数据大批量到过期时间**，而查询数据量巨大，引起数据库压力过大甚至down机。

缓存击穿指并发查**同一条数据**，缓存雪崩是**不同数据都过期**了，很多数据都查不到从而查数据库。



**解决方案**：

1. 缓存数据的**随机设置过期时间**，防止同一时间大量数据过期现象发生。
2. 如果缓存数据库是分布式部署，将热点数据均匀分布在不同得缓存数据库中。
3. **设置热点数据永远不过期。**

